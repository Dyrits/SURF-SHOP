<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.css' rel='stylesheet' />

<style>
  body {
    margin: 0;
    padding: 0;
  }

  #map {
    width: 400px;
    height: 300px;
  }

  .marker {
    background-image: url("/assets/mapbox-icon.png");
    background-size: cover;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    cursor: pointer;
  }

  .mapboxgl-popup {
    max-width: 200px;
  }

  .mapboxgl-popup-content {
    text-align: center;
    font-family: 'Open Sans', sans-serif;
  }
</style>

<h1><%= post.title %></h1>
<p>Price: <%= post.price %></p>
<p>Description: <%= post.description %></p>
<p>Location: <%= post.location %></p>
<div>
    <% for (image of post.images) { %>
        <img src="<%= image.url %>" alt="<%= post.title %>" width="200" height="200">
    <% } %>
</div>
<div id="map"></div>
<div><a href="/posts/<%= post.id %>/edit">
        <button>Edit post</button>
    </a></div>
<div>
    <form action="/posts/<%= post.id %>?_method=DELETE" method="POST">
        <input type="submit" value="Delete post">
    </form>
</div>

<script>

  mapboxgl.accessToken = "pk.eyJ1IjoiZHlyaXRzIiwiYSI6ImNsZmZiMWw4bDNuZnkzc250NHgxMm9uc2sifQ.q9tvE4qr0wJeAyFNc-bRSg";

  const map = new mapboxgl.Map({
    container: "map",
    style: "mapbox://styles/mapbox/light-v11",
    center: [-96, 37.8],
    zoom: 3
  });

  const geojson = {
    type: "FeatureCollection",
    features: [
      {
        type: "Feature",
        geometry: {
          type: "Point",
          coordinates: [-77.032, 38.913]
        },
        properties: {
          title: "Mapbox",
          description: "Washington, D.C."
        }
      },
      {
        type: "Feature",
        geometry: {
          type: "Point",
          coordinates: [-122.414, 37.776]
        },
        properties: {
          title: "Mapbox",
          description: "San Francisco, California"
        }
      }
    ]
  };

  for (const feature of geojson.features) {
    const div = document.createElement("div");
    div.className = "marker";
    new mapboxgl.Marker(div).setLngLat(feature.geometry.coordinates).setPopup(
      new mapboxgl.Popup({ offset: 25 }).setHTML(`<h3>${feature.properties.title}</h3><p>${feature.properties.description}</p>`)
    ).addTo(map);
  }


</script>
