<h1>New</h1>

<form action="/posts/<%= post.id %>?_method=PUT" method="POST">
    <div><input type="text" name="title" placeholder="Title~" value="<%= post.title %>"></div>
    <div><input type="text" name="price" placeholder="Price~" value="<%= post.price %>"></div>
    <div><input type="file" name="images" accept="image/*" multiple id="images"></div>
    <div>
        <% for (image of post.images) { %>
            <img src="<%= image.url %>" alt="<%= post.title %>" width="100" height="100">
            <label for="image<%= image.id %>">Delete ?</label>
            <input type="checkbox" name="confirm-deletion" value="<%= image.id %>" id="image<%= image.id %>" class="confirm-deletion">
        <% } %>
    </div>
    <div><textarea name="description" id="" cols="30" rows="10" placeholder="Description~"><%= post.description %></textarea></div>
    <div><input type="text" name="location" placeholder="Location~" value="<%= post.location %>"></div>
    <div><input type="submit"></div>
</form>

<script>
    const form = document.querySelector("form");
    form.addEventListener("submit", function($event) {
        $event.preventDefault();
        const images = document.querySelector('#images');
        const checkboxes = document.querySelectorAll(".confirm-deletion");
        const total = images.length + checkboxes.length - ...checkboxes.filter(checkbox => checkbox.checked).length;
        alert(total);
        if (total > 4) {
            $event.preventDefault()
            alert("A post can only contains up to 4 images.");
        }
    });
</script>